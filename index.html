<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Heisenberg Menu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --bg-primary: #111827;
            --bg-secondary: #1F2937;
            --bg-tertiary: #374151;
            --accent-primary: #3b82f6;
            --accent-secondary: #60a5fa;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
            background: transparent;
            font-family: 'Roboto', sans-serif;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            overflow: hidden;
            user-select: none;
        }

        .menu-wrapper {
            position: absolute;
            left: 50px;
            top: 50px;
            width: 550px;
            display: none; /* Initially hidden, controlled by JS */
            flex-direction: row;
            gap: 15px;
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }

        .menu-wrapper.visible {
            opacity: 1;
            transform: translateX(0);
        }
        
        .main-container {
            background-color: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            width: 250px;
        }

        .header {
            padding: 15px;
            text-align: center;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            border-radius: 8px 8px 0 0;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .category-list, .item-list {
            list-style: none;
            margin: 0;
            padding: 10px;
            overflow-y: auto;
        }

        .list-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item:hover {
            background-color: var(--bg-tertiary);
        }

        .list-item.active {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .sub-container {
            background-color: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px_30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            width: 285px;
        }

        .tabs {
            display: flex;
            background-color: var(--bg-secondary);
            border-radius: 8px 8px 0 0;
            padding: 5px;
            overflow-x: auto;
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .tabs::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .tab {
            padding: 8px 12px;
            text-align: center;
            flex-grow: 1;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            transition: background-color 0.2s ease, color 0.2s ease;
            white-space: nowrap;
        }
        
        .tab:hover {
            background-color: var(--bg-tertiary);
        }

        .tab.active {
            background-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .value-display {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .list-item.active .value-display {
            color: var(--text-primary);
        }
        
        .footer {
            margin-top: auto;
            padding: 10px 15px;
            font-size: 12px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
            border-radius: 0 0 8px 8px;
            text-align: center;
        }

    </style>
</head>
<body>

    <div class="menu-wrapper" id="menu-wrapper">
        <div class="main-container">
            <div class="header">
                <h1 id="menu-title">Heisenberg</h1>
            </div>
            <ul class="category-list" id="category-list">
                </ul>
             <div class="footer" id="main-footer"></div>
        </div>
        <div class="sub-container" id="sub-container">
             <div class="tabs" id="tabs">
                </div>
            <ul class="item-list" id="item-list">
                 </ul>
             <div class="footer" id="sub-footer"></div>
        </div>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let menuConfig = {};
        let activeCategory = '';
        let activeSubCategory = '';
        let categoryIndex = 0;
        let itemIndex = 0;
        let menuVisible = false;

        // --- NUI MESSAGE HANDLING ---
        const sendNuiMessage = (type, payload = {}) => {
            fetch(`https://macho/${type}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json; charset=UTF-8' },
                body: JSON.stringify(payload)
            }).catch(err => console.error("NUI Message Failed:", err));
        };
        
        window.addEventListener('message', (event) => {
            const { type, payload } = event.data;

            if (type === 'show') {
                menuConfig = payload.config;
                activeCategory = Object.keys(menuConfig)[0];
                activeSubCategory = menuConfig[activeCategory].subCategories[0];
                categoryIndex = 0;
                itemIndex = 0;
                render();
                document.getElementById('menu-wrapper').style.display = 'flex';
                setTimeout(() => { 
                    document.getElementById('menu-wrapper').classList.add('visible');
                    menuVisible = true;
                }, 10);

            } else if (type === 'hide') {
                document.getElementById('menu-wrapper').classList.remove('visible');
                 setTimeout(() => { 
                    document.getElementById('menu-wrapper').style.display = 'none';
                    menuVisible = false;
                }, 300);
            }
        });

        // --- RENDER FUNCTIONS ---
        const render = () => {
            if (!activeCategory || !menuConfig[activeCategory]) return;
            renderCategories();
            renderSubCategories();
            renderItems();
            updateFooters();
        };
        
        const renderCategories = () => {
            const catList = document.getElementById('category-list');
            catList.innerHTML = '';
            Object.keys(menuConfig).forEach((catName, index) => {
                const li = document.createElement('li');
                li.className = 'list-item';
                if (index === categoryIndex) li.classList.add('active');
                li.textContent = catName;
                catList.appendChild(li);
            });
        };

        const renderSubCategories = () => {
            const tabs = document.getElementById('tabs');
            tabs.innerHTML = '';
            const subCategories = menuConfig[activeCategory].subCategories;
            const subCategoryIdx = subCategories.indexOf(activeSubCategory);

            subCategories.forEach((subCatName, index) => {
                const tab = document.createElement('div');
                tab.className = 'tab';
                if (index === subCategoryIdx) tab.classList.add('active');
                tab.textContent = subCatName;
                tabs.appendChild(tab);
            });
        };

        const renderItems = () => {
            const itemList = document.getElementById('item-list');
            itemList.innerHTML = '';
            const items = menuConfig[activeCategory].items.filter(item => item.subCategory === activeSubCategory);

            if (items.length === 0) {
                itemList.innerHTML = '<li class="list-item">No items in this category.</li>';
                return;
            }

            items.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'list-item';
                if (index === itemIndex) li.classList.add('active');

                const nameSpan = document.createElement('span');
                nameSpan.textContent = item.name;

                const valueSpan = document.createElement('span');
                valueSpan.className = 'value-display';

                switch (item.type) {
                    case 'toggle':
                        valueSpan.textContent = item.value ? 'ON' : 'OFF';
                        break;
                    case 'slider':
                        valueSpan.textContent = `< ${item.value.toFixed(2)} >`;
                        break;
                    case 'button':
                        valueSpan.textContent = 'Execute';
                        break;
                    default:
                         valueSpan.textContent = '>';
                }

                li.appendChild(nameSpan);
                li.appendChild(valueSpan);
                itemList.appendChild(li);
            });
        };

        const updateFooters = () => {
            document.getElementById('main-footer').textContent = `${categoryIndex + 1} / ${Object.keys(menuConfig).length}`;
            const items = menuConfig[activeCategory].items.filter(item => item.subCategory === activeSubCategory);
            document.getElementById('sub-footer').textContent = items.length > 0 ? `${itemIndex + 1} / ${items.length}` : '0 / 0';
        };


        // --- KEYBOARD INPUT HANDLING ---
        document.addEventListener('keydown', (e) => {
            if (!menuVisible) return;
            
            e.preventDefault();

            const categories = Object.keys(menuConfig);
            const subCategories = menuConfig[activeCategory].subCategories;
            const items = menuConfig[activeCategory].items.filter(item => item.subCategory === activeSubCategory);
            const currentItem = items[itemIndex];

            switch (e.key) {
                case 'ArrowUp':
                    itemIndex = (itemIndex - 1 + items.length) % items.length;
                    break;
                case 'ArrowDown':
                    itemIndex = (itemIndex + 1) % items.length;
                    break;
                case 'PageUp': // Kategoriler arasında yukarı git
                    categoryIndex = (categoryIndex - 1 + categories.length) % categories.length;
                    activeCategory = categories[categoryIndex];
                    activeSubCategory = menuConfig[activeCategory].subCategories[0];
                    itemIndex = 0;
                    break;
                case 'PageDown': // Kategoriler arasında aşağı git
                    categoryIndex = (categoryIndex + 1) % categories.length;
                    activeCategory = categories[categoryIndex];
                    activeSubCategory = menuConfig[activeCategory].subCategories[0];
                    itemIndex = 0;
                    break;
                case 'ArrowLeft': {
                    if (currentItem && currentItem.type === 'slider') {
                        // Slider değeri azalt
                        const step = (currentItem.max - currentItem.min) / 20;
                        currentItem.value = Math.max(currentItem.min, currentItem.value - step);
                        sendNuiMessage('updateItem', { category: activeCategory, itemName: currentItem.name, value: currentItem.value });
                    } else {
                        // Tab değiştir
                        let subIndex = subCategories.indexOf(activeSubCategory);
                        subIndex = (subIndex - 1 + subCategories.length) % subCategories.length;
                        activeSubCategory = subCategories[subIndex];
                        itemIndex = 0;
                    }
                    break;
                }
                case 'ArrowRight': {
                     if (currentItem && currentItem.type === 'slider') {
                        // Slider değeri artır
                        const step = (currentItem.max - currentItem.min) / 20;
                        currentItem.value = Math.min(currentItem.max, currentItem.value + step);
                        sendNuiMessage('updateItem', { category: activeCategory, itemName: currentItem.name, value: currentItem.value });
                    } else {
                        // Tab değiştir
                        let subIndex = subCategories.indexOf(activeSubCategory);
                        subIndex = (subIndex + 1) % subCategories.length;
                        activeSubCategory = subCategories[subIndex];
                        itemIndex = 0;
                    }
                    break;
                }
                case 'Enter':
                    if (currentItem) {
                        sendNuiMessage('executeAction', { category: activeCategory, itemName: currentItem.name });
                        if(currentItem.type === 'toggle') {
                             currentItem.value = !currentItem.value; // Anında UI tepkisi için
                        }
                    }
                    break;
                case 'Escape':
                    sendNuiMessage('closeMenu');
                    break;
            }
            render();
        });
    </script>
</body>
</html>
