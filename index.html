-- Phaze Style FiveM Menu
local menu = nil
local menuOpen = false

-- GitHub Pages URL'in
local menuUrl = "https://iwauxy.github.io/fivem-menu/"

-- Men√º olu≈ütur
function CreatePhazeMenu()
    menu = MachoCreateDui(menuUrl)
    if menu then
        print("üéÆ Phaze Menu olu≈üturuldu!")
        return true
    else
        print("‚ùå Phaze Menu olu≈üturulamadƒ±!")
        return false
    end
end

-- Men√º a√ß/kapat
function TogglePhazeMenu()
    if not menu then 
        CreatePhazeMenu()
        Wait(1000) -- Men√º y√ºklenmesi i√ßin bekle
    end
    
    if menuOpen then
        MachoHideDui(menu)
        menuOpen = false
        SetNuiFocus(false, false)
        print("üì± Phaze Menu kapatƒ±ldƒ±")
    else
        MachoShowDui(menu)
        menuOpen = true
        SetNuiFocus(true, true)
        print("üì± Phaze Menu a√ßƒ±ldƒ±")
        
        -- Ho≈ügeldin mesajƒ±
        SendNotification("Phaze Menu a√ßƒ±ldƒ±!", "success")
    end
end

-- Ana men√º kategorileri
function HandleMainCategory(category)
    print("üìÇ Kategori se√ßildi: " .. tostring(category))
    
    -- Kategori deƒüi≈ütirme mesajƒ± g√∂nder
    if menu then
        local categoryMessage = {
            type = "categoryChanged",
            category = category
        }
        MachoSendDuiMessage(menu, json.encode(categoryMessage))
    end
end

-- Player kategorisi komutlarƒ±
function HandlePlayerCommands(action)
    local ped = PlayerPedId()
    
    if action == "god_mode" then
        SetEntityInvincible(ped, true)
        SendNotification("God Mode aktif!", "success")
        
    elseif action == "infinite_health" then
        SetEntityHealth(ped, GetEntityMaxHealth(ped))
        SetPedArmour(ped, 100)
        SendNotification("Can ve zƒ±rh maksimuma √ßƒ±karƒ±ldƒ±!", "success")
        
    elseif action == "fast_run" then
        SetRunSprintMultiplierForPlayer(PlayerId(), 1.49)
        SendNotification("Hƒ±zlƒ± ko≈üma aktif!", "success")
        
    elseif action == "super_jump" then
        SetSuperJumpThisFrame(PlayerId())
        SendNotification("S√ºper zƒ±plama aktif!", "success")
    end
end

-- Server kategorisi komutlarƒ±
function HandleServerCommands(action)
    if action == "change_weather" then
        local weathers = {"CLEAR", "CLOUDS", "RAIN", "THUNDER", "SNOW", "BLIZZARD", "FOGGY"}
        local randomWeather = weathers[math.random(#weathers)]
        SetWeatherTypeNow(randomWeather)
        SendNotification("Hava durumu: " .. randomWeather, "info")
        
    elseif action == "set_time" then
        local hours = {6, 12, 18, 0} -- Sabah, √∂ƒülen, ak≈üam, gece
        local randomHour = hours[math.random(#hours)]
        NetworkOverrideClockTime(randomHour, 0, 0)
        SendNotification("Zaman " .. randomHour .. ":00 yapƒ±ldƒ±!", "info")
        
    elseif action == "server_info" then
        local serverName = GetConvar("sv_hostname", "Unknown Server")
        local playerCount = GetNumberOfPlayers()
        SendNotification("Server: " .. serverName .. " | Oyuncular: " .. playerCount, "info")
    end
end

-- Weapon kategorisi komutlarƒ±
function HandleWeaponCommands(action)
    local ped = PlayerPedId()
    
    if action == "give_all_weapons" then
        local weapons = {
            "WEAPON_PISTOL", "WEAPON_ASSAULTRIFLE", "WEAPON_SMG",
            "WEAPON_SHOTGUN", "WEAPON_SNIPERRIFLE", "WEAPON_CARBINERIFLE"
        }
        
        for _, weapon in ipairs(weapons) do
            GiveWeaponToPed(ped, GetHashKey(weapon), 999, false, true)
        end
        SendNotification("T√ºm silahlar verildi!", "success")
        
    elseif action == "infinite_ammo" then
        SetPedInfiniteAmmoClip(ped, true)
        SendNotification("Sonsuz mermi aktif!", "success")
        
    elseif action == "no_recoil" then
        -- Bu fonksiyon executor'ƒ±nƒ±zƒ±n desteklediƒüi ≈üekilde ayarlanmalƒ±
        SendNotification("No recoil aktif!", "success")
    end
end

-- Combat kategorisi komutlarƒ±
function HandleCombatCommands(action)
    if action == "aimbot" then
        SendNotification("Aimbot aktif! (Sim√ºlasyon)", "success")
        
    elseif action == "esp" then
        SendNotification("ESP aktif! (Sim√ºlasyon)", "success")
        
    elseif action == "no_spread" then
        SendNotification("No spread aktif!", "success")
    end
end

-- Vehicle kategorisi komutlarƒ±
function HandleVehicleCommands(action)
    local ped = PlayerPedId()
    
    if action == "spawn_vehicle" then
        local vehicles = {"adder", "zentorno", "t20", "osiris", "entityxf"}
        local randomVehicle = vehicles[math.random(#vehicles)]
        local hash = GetHashKey(randomVehicle)
        
        RequestModel(hash)
        while not HasModelLoaded(hash) do Wait(1) end
        
        local coords = GetEntityCoords(ped)
        local vehicle = CreateVehicle(hash, coords.x + 3, coords.y, coords.z, GetEntityHeading(ped), true, false)
        TaskWarpPedIntoVehicle(ped, vehicle, -1)
        SendNotification("Ara√ß spawn edildi: " .. randomVehicle, "success")
        
    elseif action == "god_mode_vehicle" then
        local vehicle = GetVehiclePedIsIn(ped, false)
        if vehicle ~= 0 then
            SetEntityInvincible(vehicle, true)
            SendNotification("Ara√ß god mode aktif!", "success")
        else
            SendNotification("Ara√ßta deƒüilsiniz!", "error")
        end
        
    elseif action == "super_speed" then
        local vehicle = GetVehiclePedIsIn(ped, false)
        if vehicle ~= 0 then
            ModifyVehicleTopSpeed(vehicle, 50.0)
            SendNotification("S√ºper hƒ±z aktif!", "success")
        else
            SendNotification("Ara√ßta deƒüilsiniz!", "error")
        end
    end
end

-- Visual kategorisi komutlarƒ±
function HandleVisualCommands(action)
    if action == "crosshair" then
        SendNotification("Crosshair aktif!", "success")
        
    elseif action == "player_names" then
        SendNotification("Oyuncu isimleri g√∂sterilecek!", "info")
        
    elseif action == "bone_esp" then
        SendNotification("Bone ESP aktif!", "success")
    end
end

-- Miscellaneous kategorisi komutlarƒ±
function HandleMiscCommands(action)
    local ped = PlayerPedId()
    
    if action == "teleport" then
        local coords = GetEntityCoords(ped)
        SetEntityCoords(ped, coords.x, coords.y, coords.z + 100, false, false, false, true)
        SendNotification("100 metre yukarƒ± teleport edildi!", "success")
        
    elseif action == "speed_hack" then
        SendNotification("Speed hack aktif!", "success")
        
    elseif action == "fly_hack" then
        SendNotification("Fly hack aktif!", "success")
    end
end

-- Settings kategorisi komutlarƒ±
function HandleSettingsCommands(action)
    if action == "key_bindings" then
        SendNotification("Tu≈ü ayarlarƒ± men√ºs√º a√ßƒ±lacak!", "info")
        
    elseif action == "menu_settings" then
        SendNotification("Men√º ayarlarƒ±!", "info")
        
    elseif action == "config" then
        SendNotification("Konfigurasyon men√ºs√º!", "info")
    end
end

-- Ana komut i≈üleyici
function HandleMenuAction(action, category)
    print("üéØ Aksiyon: " .. tostring(action) .. " | Kategori: " .. tostring(category or "main"))
    
    -- Ana kategori se√ßimleri
    if category == nil or category == "main" then
        if action == "player" or action == "server" or action == "weapon" or 
           action == "combat" or action == "vehicle" or action == "visual" or 
           action == "miscellaneous" or action == "settings" then
            HandleMainCategory(action)
            return
        end
    end
    
    -- Alt men√º komutlarƒ±
    if string.find(action, "player") or category == "player" then
        HandlePlayerCommands(action)
    elseif string.find(action, "server") or category == "server" then
        HandleServerCommands(action)
    elseif string.find(action, "weapon") or category == "weapon" then
        HandleWeaponCommands(action)
    elseif string.find(action, "combat") or category == "combat" then
        HandleCombatCommands(action)
    elseif string.find(action, "vehicle") or category == "vehicle" then
        HandleVehicleCommands(action)
    elseif string.find(action, "visual") or category == "visual" then
        HandleVisualCommands(action)
    elseif string.find(action, "misc") or category == "miscellaneous" then
        HandleMiscCommands(action)
    elseif string.find(action, "settings") or category == "settings" then
        HandleSettingsCommands(action)
    else
        print("‚ùå Bilinmeyen komut: " .. tostring(action))
        SendNotification("Bilinmeyen komut!", "error")
    end
end

-- Bildirim g√∂nderme
function SendNotification(message, notType)
    if menu then
        local notification = {
            type = "showNotification",
            message = message,
            notificationType = notType or "info"
        }
        MachoSendDuiMessage(menu, json.encode(notification))
    end
    print("üì¢ " .. message)
end

-- HTML'den mesaj geldiƒüinde
function OnDuiMessage(data)
    local success, messageData = pcall(json.decode, data)
    
    if success and messageData then
        if messageData.type == "menuAction" then
            HandleMenuAction(messageData.action, messageData.category)
        elseif messageData.type == "closeMenu" then
            TogglePhazeMenu()
        end
    end
end

-- Tu≈ü kontrolleri
Citizen.CreateThread(function()
    while true do
        Citizen.Wait(0)
        
        -- Insert tu≈üu ile men√º a√ß/kapat (Insert = 121)
        if IsControlJustPressed(0, 121) then
            TogglePhazeMenu()
        end
        
        -- F6 ile de a√ßƒ±labilir
        if IsControlJustPressed(0, 167) then
            TogglePhazeMenu()
        end
    end
end)

-- Oyun ba≈üladƒ±ƒüƒ±nda men√ºy√º hazƒ±rla
Citizen.CreateThread(function()
    Wait(3000) -- 3 saniye bekle
    CreatePhazeMenu()
    print("üéÆ Phaze Menu sistemi y√ºklendi!")
    print("üéØ Insert veya F6 ile men√ºy√º a√ßabilirsiniz")
    print("üéØ Keyboard: ‚Üë‚Üì Navigate, Enter Select, ESC Close")
end)

-- Temizlik
AddEventHandler('onResourceStop', function(resourceName)
    if (GetCurrentResourceName() ~= resourceName) then return end
    if menu then
        MachoDestroyDui(menu)
    end
    SetNuiFocus(false, false)
end)

-- Export fonksiyonlarƒ±
exports('TogglePhazeMenu', TogglePhazeMenu)
exports('SendMenuNotification', SendNotification)

print("üìú Phaze Menu Script y√ºklendi!")
