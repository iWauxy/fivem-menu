<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FiveM Advanced Menu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            background: transparent !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            /* Tam ≈üeffaflƒ±k i√ßin */
            -webkit-app-region: no-drag;
            position: relative;
        }
        
        /* Arka plan tamamen ≈üeffaf */
        html::before, html::after, 
        body::before, body::after {
            display: none !important;
        }
        
        .menu-container {
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.98), rgba(25, 25, 45, 0.98));
            border-radius: 12px;
            width: 320px;
            height: 480px;
            border: 2px solid rgba(100, 150, 255, 0.6);
            box-shadow: 0 0 30px rgba(100, 150, 255, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            /* Macho DUI i√ßin */
            z-index: 9999;
        }
        
        /* Header */
        .header {
            background: linear-gradient(90deg, rgba(50, 100, 200, 0.9), rgba(100, 150, 255, 0.9));
            padding: 12px 20px;
            text-align: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            border-bottom: 1px solid rgba(100, 150, 255, 0.3);
        }
        
        /* Sub Header (Tabs) */
        .sub-header {
            background: rgba(20, 20, 35, 0.95);
            height: 45px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 1px solid rgba(100, 150, 255, 0.1);
        }
        
        .tab:last-child {
            border-right: none;
        }
        
        .tab.active {
            background: linear-gradient(135deg, rgba(50, 100, 200, 0.7), rgba(100, 150, 255, 0.7));
            color: white;
            transform: translateY(-2px);
        }
        
        /* Content Area */
        .content {
            flex: 1;
            padding: 8px;
            background: rgba(8, 8, 8, 0.8);
            overflow: hidden;
            position: relative;
        }
        
        .menu-item {
            background: linear-gradient(135deg, rgba(25, 25, 35, 0.9), rgba(35, 35, 50, 0.9));
            margin: 4px 0;
            padding: 12px 16px;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(100, 150, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            transform: translateX(-8px) scale(0.98);
            opacity: 0.7;
            position: relative;
            overflow: hidden;
        }
        
        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(180deg, rgba(100, 150, 255, 0.8), rgba(50, 100, 200, 0.8));
            transform: translateX(-3px);
            transition: all 0.4s ease;
        }
        
        .menu-item.selected {
            background: linear-gradient(135deg, rgba(50, 100, 200, 0.85), rgba(100, 150, 255, 0.85));
            color: white;
            border-color: rgba(100, 150, 255, 0.9);
            box-shadow: 0 0 25px rgba(100, 150, 255, 0.5);
            transform: translateX(0px) scale(1.03);
            opacity: 1;
            animation: selectedPulse 2s ease-in-out infinite;
        }
        
        .menu-item.selected::before {
            transform: translateX(0px);
            width: 4px;
            box-shadow: 0 0 10px rgba(100, 150, 255, 0.8);
        }
        
        @keyframes selectedPulse {
            0%, 100% {
                box-shadow: 0 0 25px rgba(100, 150, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 35px rgba(100, 150, 255, 0.7);
            }
        }
        
        /* Smooth scrolling animation */
        .menu-item.slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        .menu-item.slide-down {
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(10px) translateX(-8px) scale(0.98);
                opacity: 0.3;
            }
            to {
                transform: translateY(0) translateX(-8px) scale(0.98);
                opacity: 0.7;
            }
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-10px) translateX(-8px) scale(0.98);
                opacity: 0.3;
            }
            to {
                transform: translateY(0) translateX(-8px) scale(0.98);
                opacity: 0.7;
            }
        }
        
        .menu-item .icon {
            font-size: 16px;
            margin-right: 8px;
        }
        
        .menu-item .arrow {
            color: rgba(100, 150, 255, 0.8);
            font-size: 16px;
        }
        
        /* Footer */
        .footer {
            background: rgba(15, 15, 25, 0.95);
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            border-top: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        /* Scrollbar */
        .scrollbar {
            position: absolute;
            right: 4px;
            top: 8px;
            bottom: 8px;
            width: 4px;
            background: rgba(100, 150, 255, 0.2);
            border-radius: 2px;
        }
        
        .scrollbar-handle {
            background: rgba(100, 150, 255, 0.8);
            border-radius: 2px;
            width: 100%;
            position: absolute;
            transition: all 0.3s ease;
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .menu-container {
            animation: slideIn 0.4s ease-out;
        }
        
        /* Main menu specific styling */
        .main-menu-item {
            background: linear-gradient(135deg, rgba(25, 25, 40, 0.9), rgba(40, 40, 60, 0.9));
        }
        
        .main-menu-item.selected {
            background: linear-gradient(135deg, rgba(60, 120, 200, 0.9), rgba(100, 150, 255, 0.9));
        }
        
        /* Search bar */
        .search-input {
            width: 100%;
            background: rgba(20, 20, 35, 0.9);
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 6px;
            padding: 10px;
            color: white;
            font-size: 14px;
            outline: none;
            margin-bottom: 8px;
        }
        
        .search-input:focus {
            border-color: rgba(100, 150, 255, 0.6);
            box-shadow: 0 0 10px rgba(100, 150, 255, 0.3);
        }
        
        .no-results {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 40px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="menu-container">
        <div class="header">
            <span>Nebula</span>
        </div>
        
        <div class="sub-header" id="subHeader">
            <!-- Tabs will be dynamically generated -->
        </div>
        
        <div class="content" id="content">
            <div class="scrollbar">
                <div class="scrollbar-handle" id="scrollHandle"></div>
            </div>
            <div id="menuItems">
                <!-- Menu items will be dynamically generated -->
            </div>
        </div>
        
        <div class="footer">
            <span>Build: 262119</span>
            <span id="itemCounter">1 / 9</span>
        </div>
    </div>
    
    <script>
        // Menu State Management
        let menuState = {
            level: "main",
            selectedIndex: 0,
            selectedSubCategory: 0,
            scrollOffset: 0,
            maxDisplayItems: 8,
            searchQuery: "",
            isSearching: false
        };
        
        // Menu Configuration
        const categories = [
            "Player", "Online", "Weapon", "Combat", 
            "Vehicle", "Visual", "Miscellaneous", "Settings", "Search"
        ];
        
        const categoryConfigs = {
            Player: {
                subCategories: ["Player", "Miscellaneous", "Wardrobe"],
                items: {
                    Player: [
                        {name: "Desync", type: "toggle", value: false, icon: "üîÑ"},
                        {name: "Clear screen effects", type: "toggle", value: false, icon: "üßπ"},
                        {name: "Clear tasks", type: "toggle", value: false, icon: "üìã"},
                        {name: "Refresh interior", type: "button", icon: "üè†"},
                        {name: "Speed multiplier", type: "slider", value: 1.0, min: 0.5, max: 3.0, icon: "‚ö°"},
                        {name: "Jump height", type: "slider", value: 1.0, min: 1.0, max: 5.0, icon: "‚¨ÜÔ∏è"}
                    ],
                    Miscellaneous: [
                        {name: "Simplify drug selling", type: "toggle", value: false, icon: "üíä"},
                        {name: "No ragdoll", type: "toggle", value: true, icon: "üö´"},
                        {name: "No collision", type: "toggle", value: true, icon: "üëª"},
                        {name: "Solo session", type: "toggle", value: true, icon: "üë§"},
                        {name: "Friendly fire", type: "toggle", value: true, icon: "üî´"},
                        {name: "Burning mode", type: "toggle", value: false, icon: "üî•"}
                    ],
                    Wardrobe: [
                        {name: "Random Outfit", type: "button", icon: "üé≤"},
                        {name: "Hair", type: "clothing", value: 0, max: 45, icon: "üíá"},
                        {name: "Hat", type: "clothing", value: 0, max: 20, icon: "üé©"},
                        {name: "Mask", type: "clothing", value: 0, max: 15, icon: "üò∑"},
                        {name: "Tops", type: "clothing", value: 0, max: 50, icon: "üëï"}
                    ]
                }
            },
            Online: {
                subCategories: ["List", "Safe", "Risky", "Vehicle", "Triggers"],
                items: {
                    List: [
                        {name: "Select All", type: "button", icon: "‚òëÔ∏è"},
                        {name: "Unselect All", type: "button", icon: "‚¨ú"},
                        {name: "Refresh List", type: "button", icon: "üîÑ"}
                    ],
                    Safe: [
                        {name: "Spectate", type: "toggle", value: false, icon: "üëÅÔ∏è"},
                        {name: "Copy Coords", type: "button", icon: "üìç"}
                    ],
                    Risky: [
                        {name: "Track Player", type: "button", icon: "üì°"},
                        {name: "Teleport To", type: "button", icon: "üöÄ"}
                    ]
                }
            },
            Weapon: {
                subCategories: ["Damage", "Accuracy", "Ammo"],
                items: {
                    Damage: [
                        {name: "Damage multiplier", type: "slider", value: 1.0, min: 1.0, max: 10.0, icon: "üí•"},
                        {name: "One shot kill", type: "toggle", value: false, icon: "‚ò†Ô∏è"}
                    ],
                    Accuracy: [
                        {name: "Perfect accuracy", type: "toggle", value: false, icon: "üéØ"},
                        {name: "No recoil", type: "toggle", value: false, icon: "üî´"}
                    ],
                    Ammo: [
                        {name: "Infinite ammo", type: "toggle", value: false, icon: "üîã"},
                        {name: "Fast reload", type: "toggle", value: false, icon: "‚ö°"}
                    ]
                }
            },
            Settings: {
                subCategories: ["General", "Keybinds", "Theme"],
                items: {
                    General: [
                        {name: "Auto save", type: "toggle", value: true, icon: "üíæ"},
                        {name: "Notifications", type: "toggle", value: true, icon: "üîî"}
                    ],
                    Keybinds: [
                        {name: "Menu key", type: "button", icon: "‚å®Ô∏è"},
                        {name: "Panic key", type: "button", icon: "üö®"}
                    ],
                    Theme: [
                        {name: "Menu opacity", type: "slider", value: 0.8, min: 0.3, max: 1.0, icon: "üé®"},
                        {name: "Animation speed", type: "slider", value: 0.15, min: 0.05, max: 0.5, icon: "‚ö°"}
                    ]
                }
            }
        };
        
        let searchResults = [];
        
        // Animation and rendering functions
        function lerp(start, end, factor) {
            return start + (end - start) * factor;
        }
        
        function updateScrollbar() {
            const currentItems = getCurrentItems();
            const scrollHandle = document.getElementById('scrollHandle');
            
            if (currentItems.length <= menuState.maxDisplayItems) {
                scrollHandle.style.display = 'none';
                return;
            }
            
            scrollHandle.style.display = 'block';
            const handleHeight = (menuState.maxDisplayItems / currentItems.length) * 100;
            const handlePosition = (menuState.scrollOffset / (currentItems.length - menuState.maxDisplayItems)) * (100 - handleHeight);
            
            scrollHandle.style.height = handleHeight + '%';
            scrollHandle.style.top = handlePosition + '%';
        }
        
        function getCurrentItems() {
            if (menuState.level === "main") {
                return categories;
            } else if (menuState.level === "search") {
                return searchResults;
            } else {
                const config = categoryConfigs[menuState.level];
                if (!config) return [];
                
                const subCategoryName = config.subCategories[menuState.selectedSubCategory];
                return config.items[subCategoryName] || [];
            }
        }
        
        function updateScrollOffset() {
            const currentItems = getCurrentItems();
            const totalItems = currentItems.length;
            
            if (totalItems <= menuState.maxDisplayItems) {
                menuState.scrollOffset = 0;
                return;
            }
            
            // Se√ßili √∂ƒüe g√∂r√ºn√ºr alanda mƒ± kontrol et
            if (menuState.selectedIndex < menuState.scrollOffset) {
                // Yukarƒ± scroll
                menuState.scrollOffset = menuState.selectedIndex;
            } else if (menuState.selectedIndex >= menuState.scrollOffset + menuState.maxDisplayItems) {
                // A≈üaƒüƒ± scroll
                menuState.scrollOffset = menuState.selectedIndex - menuState.maxDisplayItems + 1;
            }
            
            // Sƒ±nƒ±rlarƒ± kontrol et
            menuState.scrollOffset = Math.max(0, Math.min(menuState.scrollOffset, totalItems - menuState.maxDisplayItems));
            
            console.log(`Scroll: ${menuState.scrollOffset}, Selected: ${menuState.selectedIndex}, Total: ${totalItems}`);
        }
        
        function resetSelection() {
            menuState.selectedIndex = 0;
            menuState.scrollOffset = 0;
        }
        
        function renderSubHeader() {
            const subHeader = document.getElementById('subHeader');
            
            if (menuState.level === "main") {
                subHeader.innerHTML = '<div class="tab active">Main menu</div>';
            } else if (menuState.level === "search") {
                subHeader.innerHTML = `<input type="text" class="search-input" placeholder="Search..." value="${menuState.searchQuery}" id="searchInput" readonly>`;
            } else {
                const config = categoryConfigs[menuState.level];
                if (!config) return;
                
                const subCategories = config.subCategories;
                subHeader.innerHTML = subCategories.map((subCat, index) => 
                    `<div class="tab ${index === menuState.selectedSubCategory ? 'active' : ''}">${subCat}</div>`
                ).join('');
            }
        }
        
        function renderMenuItems() {
            const menuItemsContainer = document.getElementById('menuItems');
            const currentItems = getCurrentItems();
            
            if (currentItems.length === 0) {
                menuItemsContainer.innerHTML = '<div class="no-results">No items found</div>';
                return;
            }
            
            const visibleStart = menuState.scrollOffset;
            const visibleEnd = Math.min(menuState.scrollOffset + menuState.maxDisplayItems, currentItems.length);
            
            let html = '';
            
            for (let i = visibleStart; i < visibleEnd; i++) {
                const item = currentItems[i];
                const isSelected = (i === menuState.selectedIndex);
                const selectedClass = isSelected ? 'selected' : '';
                
                if (menuState.level === "main") {
                    const icon = item === "Search" ? "üîç" : "‚Ä∫";
                    html += `
                        <div class="menu-item main-menu-item ${selectedClass}" data-index="${i}">
                            <span>${item}</span>
                            <span class="arrow">${icon}</span>
                        </div>
                    `;
                } else if (menuState.level === "search") {
                    html += `
                        <div class="menu-item ${selectedClass}" data-index="${i}">
                            <span><span class="icon">${item.item.icon || '‚Ä¢'}</span>${item.item.name}</span>
                            <span style="font-size: 11px; color: rgba(255,255,255,0.5);">${item.category} > ${item.subCategoryName}</span>
                        </div>
                    `;
                } else {
                    let rightContent = '‚Ä∫';
                    
                    if (item.type === 'toggle') {
                        rightContent = `<span style="color: ${item.value ? '#64ff64' : '#ff6464'}">${item.value ? 'ON' : 'OFF'}</span>`;
                    } else if (item.type === 'slider') {
                        rightContent = `<span style="color: #64b5ff">${item.value.toFixed(1)}</span>`;
                    } else if (item.type === 'clothing') {
                        rightContent = `<span style="color: #ffb464">[${item.value}/${item.max}]</span>`;
                    } else if (item.type === 'button') {
                        rightContent = '<span style="color: #64ff64">[EXEC]</span>';
                    }
                    
                    html += `
                        <div class="menu-item ${selectedClass}" data-index="${i}">
                            <span><span class="icon">${item.icon || '‚Ä¢'}</span>${item.name}</span>
                            <span class="arrow">${rightContent}</span>
                        </div>
                    `;
                }
            }
            
            menuItemsContainer.innerHTML = html;
            
            // Update item counter
            document.getElementById('itemCounter').textContent = `${menuState.selectedIndex + 1} / ${currentItems.length}`;
            
            // Update scrollbar
            updateScrollbar();
        }
        
        function performSearch(query) {
            searchResults = [];
            if (query === "") return;
            
            const queryLower = query.toLowerCase();
            for (const [catName, config] of Object.entries(categoryConfigs)) {
                for (const [subCatName, items] of Object.entries(config.items)) {
                    items.forEach(item => {
                        if (item.name.toLowerCase().includes(queryLower)) {
                            searchResults.push({
                                item: item,
                                category: catName,
                                subCategoryName: subCatName
                            });
                        }
                    });
                }
            }
        }
        
        function render() {
            renderSubHeader();
            renderMenuItems();
        }
        
        // Macho DUI i√ßin √∂zel input handling - Geli≈ütirilmi≈ü
        function machoDuiKeyHandler(key) {
            console.log('Macho DUI Key:', key);
            
            const currentItems = getCurrentItems();
            const oldIndex = menuState.selectedIndex;
            
            switch (key) {
                case 'ArrowUp':
                case 'Up':
                    menuState.selectedIndex = Math.max(0, menuState.selectedIndex - 1);
                    // Wrap around: en √ºstteyken yukarƒ± gidince en a≈üaƒüƒ±ya git
                    if (menuState.selectedIndex === 0 && oldIndex === 0) {
                        menuState.selectedIndex = currentItems.length - 1;
                    }
                    updateScrollOffset();
                    addScrollAnimation('slide-up');
                    break;
                    
                case 'ArrowDown':
                case 'Down':
                    menuState.selectedIndex = Math.min(currentItems.length - 1, menuState.selectedIndex + 1);
                    // Wrap around: en alttayken a≈üaƒüƒ± gidince en yukarƒ± git
                    if (menuState.selectedIndex === currentItems.length - 1 && oldIndex === currentItems.length - 1) {
                        menuState.selectedIndex = 0;
                    }
                    updateScrollOffset();
                    addScrollAnimation('slide-down');
                    break;
                    
                case 'Enter':
                case 'Return':
                case 'Space':
                    handleEnterPress();
                    break;
                    
                case 'Backspace':
                case 'Back':
                case 'Escape':
                    if (menuState.level !== "main") {
                        menuState.level = "main";
                        menuState.isSearching = false;
                        menuState.searchQuery = "";
                        menuState.selectedSubCategory = 0;
                        resetSelection();
                    }
                    break;
                    
                // Sadece Q ve E ile yatay hareket
                case 'KeyQ':
                case 'Q':
                case 'q':
                    if (menuState.level !== "main" && menuState.level !== "search") {
                        const config = categoryConfigs[menuState.level];
                        if (config) {
                            menuState.selectedSubCategory = Math.max(0, menuState.selectedSubCategory - 1);
                            resetSelection();
                        }
                    } else {
                        handleSliderInput(false);
                    }
                    break;
                    
                case 'KeyE':
                case 'E':
                case 'e':
                    if (menuState.level !== "main" && menuState.level !== "search") {
                        const config = categoryConfigs[menuState.level];
                        if (config) {
                            menuState.selectedSubCategory = Math.min(config.subCategories.length - 1, menuState.selectedSubCategory + 1);
                            resetSelection();
                        }
                    } else {
                        handleSliderInput(true);
                    }
                    break;
                    
                // Sol/Saƒü ok tu≈ülarƒ± da slider i√ßin
                case 'ArrowLeft':
                case 'Left':
                    handleSliderInput(false);
                    break;
                    
                case 'ArrowRight':
                case 'Right':
                    handleSliderInput(true);
                    break;
            }
            
            render();
            return true; // Indicate handled
        }
        
        // Scroll animasyonu ekleme
        function addScrollAnimation(animClass) {
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.classList.remove('slide-up', 'slide-down');
                item.classList.add(animClass);
            });
            
            // Animasyonu temizle
            setTimeout(() => {
                menuItems.forEach(item => {
                    item.classList.remove(animClass);
                });
            }, 300);
        }
        
        function handleEnterPress() {
            const currentItems = getCurrentItems();
            
            if (menuState.level === "main") {
                const selectedCategory = currentItems[menuState.selectedIndex];
                if (selectedCategory === "Search") {
                    menuState.level = "search";
                    menuState.searchQuery = "";
                    searchResults = [];
                    resetSelection();
                } else if (categoryConfigs[selectedCategory]) {
                    menuState.level = selectedCategory;
                    menuState.selectedSubCategory = 0;
                    resetSelection();
                }
            } else if (menuState.level === "search") {
                // Handle search input or selection
                if (searchResults.length > 0 && menuState.selectedIndex < searchResults.length) {
                    const result = searchResults[menuState.selectedIndex];
                    menuState.level = result.category;
                    menuState.isSearching = false;
                    
                    // Find subcategory index
                    const subCats = categoryConfigs[result.category].subCategories;
                    menuState.selectedSubCategory = subCats.indexOf(result.subCategoryName);
                    resetSelection();
                }
            } else {
                // Handle item interaction
                const item = currentItems[menuState.selectedIndex];
                if (item) {
                    if (item.type === 'toggle') {
                        item.value = !item.value;
                        // Send message to Lua
                        sendMessageToLua({
                            type: 'toggle',
                            item: item.name,
                            value: item.value,
                            playerId: item.playerId || null
                        });
                    } else if (item.type === 'button') {
                        // Send button press to Lua
                        sendMessageToLua({
                            type: 'button',
                            item: item.name
                        });
                    } else if (item.type === 'clothing' || item.type === 'slider') {
                        // Slider ve clothing i√ßin deƒüer g√∂nder
                        sendMessageToLua({
                            type: item.type,
                            item: item.name,
                            value: item.value
                        });
                    }
                }
            }
        }
        
        function handleSliderInput(increase) {
            const currentItems = getCurrentItems();
            const item = currentItems[menuState.selectedIndex];
            
            if (item && (item.type === 'slider' || item.type === 'clothing')) {
                const step = item.type === 'slider' ? (item.max - item.min) / 20 : 1;
                
                if (increase) {
                    if (item.type === 'clothing') {
                        item.value = (item.value + 1) % (item.max + 1);
                    } else {
                        item.value = Math.min(item.max, item.value + step);
                    }
                } else {
                    if (item.type === 'clothing') {
                        item.value = item.value === 0 ? item.max : item.value - 1;
                    } else {
                        item.value = Math.max(item.min, item.value - step);
                    }
                }
                
                // Send update to Lua
                sendMessageToLua({
                    type: item.type,
                    item: item.name,
                    value: item.value
                });
            }
        }
        
        function sendMessageToLua(data) {
            try {
                console.log('Attempting to send to Lua:', data);
                
                // Macho DUI i√ßin √∂zel mesaj g√∂nderimi
                if (window.parent && window.parent.postMessage) {
                    window.parent.postMessage(data, '*');
                    console.log('Sent via postMessage');
                }
                
                // Alternative: Execute command via window object
                if (window.invokeNative) {
                    const command = `menu_action ${JSON.stringify(data).replace(/"/g, '\\"')}`;
                    window.invokeNative('ExecuteCommand', command);
                    console.log('Sent via invokeNative');
                }
                
                // Macho DUI direct call
                if (typeof SendNUIMessage !== 'undefined') {
                    SendNUIMessage(data);
                    console.log('Sent via SendNUIMessage');
                }
                
            } catch (e) {
                console.error('Failed to send message to Lua:', e);
            }
        }
        
        // Lua'dan mesaj alma fonksiyonu - Macho DUI i√ßin
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type) {
                receiveMessage(event.data);
            }
        });
        
        window.receiveMessage = function(data) {
            console.log('Received from Lua:', data);
            
            if (data.type === 'updatePlayers') {
                updateOnlinePlayersList(data.players);
            } else if (data.type === 'notification') {
                showNotification(data.message, data.type);
            } else if (data.type === 'keyPress') {
                // Lua'dan gelen tu≈ü basƒ±mlarƒ±nƒ± i≈üle
                machoDuiKeyHandler(data.key);
            }
        };
        
        // Global keyboard handler - Macho DUI i√ßin
        window.handleKey = function(key) {
            return machoDuiKeyHandler(key);
        };
        
        // Online oyuncular listesini g√ºncelle
        function updateOnlinePlayersList(players) {
            // Online kategorisindeki oyuncu listesini g√ºncelle
            const onlineConfig = categoryConfigs.Online;
            if (onlineConfig && onlineConfig.items.List) {
                // Statik √∂ƒüeleri koru, oyuncularƒ± ekle
                const staticItems = onlineConfig.items.List.filter(item => 
                    !item.name.startsWith('[') || !item.name.includes(']')
                );
                
                const playerItems = players.map(player => ({
                    name: `[${player.id}] ${player.name}`,
                    type: "toggle",
                    value: false,
                    icon: "üë§",
                    playerId: player.id,
                    distance: player.distance
                }));
                
                onlineConfig.items.List = [...staticItems, ...playerItems];
                
                // Eƒüer Online/List kategorisindeyse render et
                if (menuState.level === "Online" && 
                    categoryConfigs.Online.subCategories[menuState.selectedSubCategory] === "List") {
                    render();
                }
            }
        }
        
        // Bildirim g√∂sterme
        function showNotification(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Men√º a√ßƒ±ldƒ±ƒüƒ±nda oyuncu listesini iste
        function requestPlayerList() {
            sendMessageToLua({
                type: 'requestPlayers'
            });
        }
        
        // Fallback event listeners (normal klavye i√ßin)
        document.addEventListener('keydown', (e) => {
            e.preventDefault();
            
            // Handle search input
            if (menuState.level === "search" && e.key.length === 1 && /^[a-zA-Z0-9 ]$/.test(e.key)) {
                menuState.searchQuery += e.key;
                performSearch(menuState.searchQuery);
                resetSelection();
                render();
                return;
            }
            
            if (menuState.level === "search" && e.key === 'Backspace' && menuState.searchQuery.length > 0) {
                menuState.searchQuery = menuState.searchQuery.slice(0, -1);
                performSearch(menuState.searchQuery);
                resetSelection();
                render();
                return;
            }
            
            // Use the Macho DUI key handler
            machoDuiKeyHandler(e.key);
        });
        
        // Initial render
        render();
        
        // Oyuncu listesini ba≈ülangƒ±√ßta iste
        setTimeout(() => {
            requestPlayerList();
        }, 1000);
        
        // Debug i√ßin console log
        console.log('üéÆ Advanced FiveM Menu loaded successfully!');
        console.log('üìã Menu State:', menuState);
        console.log('üîß Macho DUI compatible version');
        
        // Test mesajƒ± g√∂nder
        setTimeout(() => {
            sendMessageToLua({
                type: 'menuLoaded',
                message: 'Menu HTML loaded successfully'
            });
        }, 500);
    </script>
</body>
</html>
